/*!
	photobox v1.6.6
	(c) 2012 Yair Even Or <http://dropthebit.com>

	Uses jQuery-mousewheel Version: 3.0.6
	(c) 2009 Brandon Aaron <http://brandonaaron.net>

	MIT-style license.
*/
(function(c){function O(a){var b,g=k.createElement("p").style,c=["ms","O","Moz","Webkit"];if(""==g[a])return a;a=a[0].toUpperCase()+a.slice(1);for(b=c.length;b--;)if(""==g[c[b]+a])return c[b]+a}function $(a){a=a.keyCode;var b=d.keys;return 0<=b.close.indexOf(a)&&G()||0<=b.next.indexOf(a)&&w(x)||0<=b.prev.indexOf(a)&&w(B)||!0}function P(){w("pbPrevBtn"==this.id?B:x);return!1}function w(a,b,g){function c(){H.off(n).removeClass("change");d.counter&&C.find(".counter").text("("+(t+1)+" / "+l.length+")"); d.title&&C.find(".title").text(l[t][1])}if(!a||0>a)a=0;e.addClass(a>t?"next":"prev");t=a;y=l[a][0];B=(t||(d.loop?l.length:0))-1;x=(t+1)%l.length||(d.loop?0:-1);Q();e.addClass("pbLoading").removeClass("error");!d.loop&&a==l.length-1?I.addClass("hide"):I.removeClass("hide");!d.loop&&0==a?J.addClass("hide"):J.removeClass("hide");H.on(n,c).addClass("change");(b||p)&&c();d.thumbs&&q.changeActive(a,b,g);0<=B&&(R.src=l[B][0]);0<=x&&(S.src=l[x][0]);p&&e.addClass("hide");d.autoplay&&h.progress.reset();u=new Image; u.onload=function(){var a=function(){f.off(n).css({transition:"none"});f[0].src=y;f[0].className="prepare";setTimeout(function(){f.removeAttr("style")[0].className="";e.removeClass("hide next prev");setTimeout(function(){f[0].className="";f.on(n,T);p&&T()},0)},50)};e.removeClass("pbLoading").addClass("hide");f.removeClass("zoomable");if(b||p)a();else f.on(n,a)};u.onerror=function(){e.removeClass("pbLoading").addClass("error");f[0].src=U;u.onerror=null};u.src=y;D.save()}function T(){f.off(n);f.addClass("zoomable"); m&&d.autoplay&&h.play();"function"==typeof E.callback&&E.callback()}function aa(a,b){var g=f.data("zoom")||1,d=f[0].getBoundingClientRect(),g=g+b/10;0.1>g&&(g=0.1);f.data("zoom",g).css({transform:"scale("+g+")"});if(d.height>r.clientHeight||d.width>r.clientWidth)c(k).on("mousemove.photobox",ba);else c(k).off("mousemove.photobox"),f[0].style[V]="50% 50%";return!1}function ca(a,b){a.preventDefault();var c=E.thumbsList;c.css("height",c[0].clientHeight+10*b);c=C[0].clientHeight/2;K[0].style.cssText="margin-top: -"+ c+"px; padding: "+c+"px 0;";j.hide().show(0);q.calc()}function ba(a){var b=100*((a.clientY/r.clientHeight*(r.clientHeight+200)-100)/r.clientHeight);a=(100*(a.clientX/r.clientWidth)).toFixed(2)+"% "+b.toFixed(2)+"%";f[0].style[V]=a}function Q(){clearTimeout(h.autoPlayTimer);c(k).off("mousemove.photobox");u.onload=function(){};u.src=R.src=S.src=y}function G(){function a(){""!=e[0].className&&(e.removeClass("show hide"),f.removeAttr("class").removeAttr("style").off().data("zoom",1),da&&setTimeout(function(){e.hide()}, 200))}Q();F.prototype.setup();D.clear();e.removeClass("on").addClass("hide");f.on(n,a);p&&a();setTimeout(a,500)}function L(a){var b=a||v.event,g=[].slice.call(arguments,1),d=0,e=0,f=0;a=c.event.fix(b);a.type="mousewheel";b.wheelDelta&&(d=b.wheelDelta/120);b.detail&&(d=-b.detail/3);f=d;void 0!==b.axis&&b.axis===b.HORIZONTAL_AXIS&&(f=0,e=-1*d);void 0!==b.wheelDeltaY&&(f=b.wheelDeltaY/120);void 0!==b.wheelDeltaX&&(e=-1*b.wheelDeltaX/120);g.unshift(a,d,e,f);return(c.event.dispatch||c.event.handle).apply(this, g)}var k=document,v=window,F,z=[],E,d,l=[],t=-1,y,B,x,q,r,h,n="transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",p=!("placeholder"in k.createElement("input")),da=!!v.ActiveXObject,W="ontouchend"in k,M,N,s=c(),U="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",V=O("transformOrigin"),ea=O("transition"),u={},R=new Image,S=new Image,f,J,I,C,H,m,j,K,fa={loop:!0,thumbs:!0,counter:!0,title:!0,autoplay:!1,time:3E3,history:!0,hideFlash:!0,keys:{close:"27, 88, 67", prev:"37, 80",next:"39, 78"}},e=c('<div id="pbOverlay">').hide().append(c('<div class="pbLoader"><b></b><b></b><b></b></div>'),K=c('<div class="imageWrap">').append(f=c("<img>"),J=c('<div id="pbPrevBtn" class="prevNext"><b></b></div>').on("click",P),I=c('<div id="pbNextBtn" class="prevNext"><b></b></div>').on("click",P)),c('<div id="pbCloseBtn">').append("<b>\u00d7</b>").on("click",G)[0],m=c('<div id="pbAutoplayBtn">').append(c('<div class="pbProgress">')),C=c('<div id="pbCaption">').append(H=c('<div class="pbCaptionText">').append('<div class="title"></div><div class="counter">'), j=c("<div>").addClass("pbThumbs")));c(k).ready(function(){p&&e.addClass("msie");m.on("click",h.toggle);j.on("click","a",q.click);W&&j.css("overflow","auto");e.on("click","img",function(a){a.stopPropagation()});c(k.body).prepend(c(e));r=k.documentElement});c.fn.photobox=function(a,b,g){"string"!=typeof a&&(a="a");b=c.extend({},fa,b||{});a=new F(b,this,a);a.callback=g;z.push(a);D.load();return this};F=function(a,b,g){this.options=c.extend({},a);this.target=g;this.selector=c(b||k);this.thumbsList=null; a=this.imageLinksFilter(b.find(g));this.imageLinks=a[0];this.images=a[1];this.init()};var X=v.MutationObserver||v.WebKitMutationObserver,ga=v.addEventListener;F.prototype={init:function(){var a=this;this.selector.data("_photobox",this);this.options.thumbs&&(this.thumbsList=q.generate(this.imageLinks));this.selector.on("click.photobox",this.target,function(b){b.preventDefault();a.open(this)});this.observerTimeout=null;1==this.selector[0].nodeType&&a.observeDOM(a.selector[0],function(){clearTimeout(a.observerTimeout); a.observerTimeout=setTimeout(function(){var b=a.imageLinksFilter(a.selector.find(a.target));a.imageLinks=b[0];a.images=b[1];a.thumbsList=q.generate(a.imageLinks)},50)})},open:function(a){var b=c.inArray(a,this.imageLinks);if(-1==b)return!1;d=this.options;l=this.images;E=this;this.setup(1);e.on(n,function(){e.off(n).addClass("on");w(b,!0)}).addClass("show");p&&e.trigger("MSTransitionEnd");return!1},imageLinksFilter:function(a){var b=[];return[a.filter(function(){var a=this.firstElementChild||this.children[0]; if(!a||!a.tagName||"img"!=a.tagName.toLowerCase())return!1;b.push([this.href,a.getAttribute("alt")||a.getAttribute("title")]);return!0}),b]},observeDOM:function(a,b){X?(new X(function(a){(a[0].addedNodes.length||a[0].removedNodes.length)&&b()})).observe(a,{childList:!0,subtree:!0}):ga&&(a.addEventListener("DOMNodeInserted",b,!1),a.addEventListener("DOMNodeRemoved",b,!1))},setup:function(a){var b=a?"on":"off";f[0].src=U;a?(f.css({transition:"0s"}).removeAttr("style"),e.show(),j.html(this.thumbsList), e[d.thumbs?"addClass":"removeClass"]("thumbs"),d.thumbs&&(s.removeAttr("class"),c(v).on("resize.photobox",q.calc),q.calc()),2>this.images.length?e.removeClass("thumbs hasArrows hasCounter hasAutoplay"):(e.addClass("hasArrows hasCounter"),1E3<d.time?(e.addClass("hasAutoplay"),d.autoplay?h.progress.start():h.pause()):e.removeClass("hasAutoplay"))):c(v).off("resize.photobox");d.hideFlash&&c.each(["object","embed"],function(b,d){c(d).each(function(){a&&(this._photobox=this.style.visibility);this.style.visibility= a?"hidden":this._photobox})});c(k)[b]({"keydown.photobox":$});K[b]({"mousewheel.photobox":aa});if(!p)j[b]({"mousewheel.photobox":ca})}};q={generate:function(a){var b=c("<ul>"),d,e=[],f,h;for(f=a.toArray().length;f--;)d=a[f],h=d.children[0].title||d.children[0].alt||"",e.push('<li><a href="'+d.href+'"><img src="'+d.children[0].src+'" alt="" title="'+h+'" /></a></li>');b.html(e.reverse().join(""));return b},click:function(a){a.preventDefault();s.removeClass("active");s=c(this).parent().addClass("active"); a=c(this.parentNode).index();return w(a,0,1)},changeActiveTimeout:null,changeActive:function(a,b,c){s.index();s.removeClass("active");s=j.find("li").eq(a).addClass("active");c||(clearTimeout(this.changeActiveTimeout),this.changeActiveTimeout=setTimeout(function(){var a=s[0].offsetLeft+s[0].clientWidth/2-r.clientWidth/2;b?j.delay(800):j.stop();j.animate({scrollLeft:a},500,"swing")},200))},calc:function(){M=j[0].clientWidth;N=j[0].firstChild.clientWidth;var a=N>M?"on":"off";!W&&j[a]("mousemove",q.move); return this},move:function(a){j[0].scrollLeft=a.pageX*(N/M)-500}};h={autoPlayTimer:!1,play:function(){h.autoPlayTimer=setTimeout(function(){w(x)},d.time);h.progress.start();m.removeClass("play");h.setTitle("Click to stop autoplay");d.autoplay=!0},pause:function(){clearTimeout(h.autoPlayTimer);h.progress.reset();m.addClass("play");h.setTitle("Click to resume autoplay");d.autoplay=!1},progress:{reset:function(){m.find("div").removeAttr("style");setTimeout(function(){m.removeClass("playing")},200)}, start:function(){p||m.find("div").css(ea,d.time+"ms");m.addClass("playing")}},setTitle:function(a){a&&m.prop("title",a+" (every "+d.time/1E3+" seconds)")},toggle:function(a){a.stopPropagation();h[d.autoplay?"pause":"play"]()}};var D={save:function(){"pushState"in window.history&&(decodeURIComponent(window.location.hash.slice(1))!=y&&d.history)&&window.history.pushState("photobox",k.title+"-"+l[t][1],window.location.pathname+window.location.search+"#"+encodeURIComponent(y))},load:function(){if(d&& !d.history)return!1;var a=decodeURIComponent(window.location.hash.slice(1)),b,c;if(!a&&e.hasClass("show"))G();else for(b=0;b<z.length;b++)for(c in z[b].images)if(z[b].images[c][0]==a)return z[b].open(z[b].imageLinks[c]),!0},clear:function(){d.history&&"pushState"in window.history&&window.history.pushState("photobox",k.title,window.location.pathname+window.location.search)}},Y=window.onpopstate;window.onpopstate=function(a){Y&&Y.apply(this,arguments);"photobox"==a.state&&D.load()};var A=["DOMMouseScroll", "mousewheel"];if(c.event.fixHooks)for(var Z=A.length;Z;)c.event.fixHooks[A[--Z]]=c.event.mouseHooks;c.event.special.mousewheel={setup:function(){if(this.addEventListener)for(var a=A.length;a;)this.addEventListener(A[--a],L,!1);else this.onmousewheel=L},teardown:function(){if(this.removeEventListener)for(var a=A.length;a;)this.removeEventListener(A[--a],L,!1);else this.onmousewheel=null}};c.fn.extend({mousewheel:function(a){return a?this.bind("mousewheel",a):this.trigger("mousewheel")},unmousewheel:function(a){return this.unbind("mousewheel", a)}})})(jQuery);